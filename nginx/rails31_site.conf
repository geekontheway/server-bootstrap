upstream unicorn_hittiger {
    server unix:/opt/deploy/hittiger/tmp/sockets/unicorn.sock;
}

server {
    listen 80;
    server_name www.youyanchu.com;
    rewrite ^(.*) http://youyanchu.com$1 permanent;
}

server {
  listen 80;
  server_name youyanchu.com yanchu.iwinux.info;
  root /opt/deploy/hittiger/public;

  access_log logs/storm.log;
  error_log logs/storm-error.log;
  client_max_body_size 4G;

  location ~ ^/assets/  {
      root /opt/deploy/hittiger/public;
      gzip_static on; # to serve pre-gzipped version
      expires max;
      add_header Cache-Control public;

      # Some browsers still send conditional-GET requests if there's a
      # Last-Modified header or an ETag header even if they haven't
      # reached the expiry date sent in the Expires header.
      add_header Last-Modified "";
      add_header ETag "";
      break;
  }


  location / {
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect off;

    if (!-f $request_filename) {
      proxy_pass http://unicorn_hittiger;
      break;
    }
  }
}
